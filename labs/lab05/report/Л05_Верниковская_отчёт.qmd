---
# Preamble

## Author
author:
  name: Верниковская Екатерина Андреевна
  degrees: DSc
  orcid: 0000-0002-0877-7063
  email: kulyabov-ds@rudn.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: "Отчёт по лабораторной работе №5"
subtitle: "Дисциплина: Администрирование сетевых подсистем"
license: "CC BY"
## Generic options
lang: ru-RU
number-sections: true
toc: true
toc-title: "Содержание"
toc-depth: 2
## Crossref customization
crossref:
  lof-title: "Список иллюстраций"
  lot-title: "Список таблиц"
  lol-title: "Листинги"
## Bibliography
bibliography:
  - bib/cite.bib
csl: _resources/csl/gost-r-7-0-5-2008-numeric.csl
## Formats
format:
### Pdf output format
  pdf:
    toc: true
    number-sections: true
    colorlinks: false
    toc-depth: 2
    lof: true # List of figures
    lot: true # List of tables
#### Document
    documentclass: scrreprt
    papersize: a4
    fontsize: 12pt
    linestretch: 1.5
#### Language
    babel-lang: russian
    babel-otherlangs: english
#### Biblatex
    cite-method: biblatex
    biblio-style: gost-numeric
    biblatexoptions:
      - backend=biber
      - langhook=extras
      - autolang=other*
#### Misc options
    csquotes: true
    indent: true
    header-includes: |
      \usepackage{indentfirst}
      \usepackage{float}
      \floatplacement{figure}{H}
      \usepackage[math,RM={Scale=0.94},SS={Scale=0.94},SScon={Scale=0.94},TT={Scale=MatchLowercase,FakeStretch=0.9},DefaultFeatures={Ligatures=Common}]{plex-otf}
### Docx output format
  docx:
    toc: true
    number-sections: true
    toc-depth: 2
---

# Цель работы

Целью данной работы является приобретение практических навыков по расширенному конфигурированию HTTP-сервера Apache в части безопасности и возможности использования PHP.

# Задание

1. Сгенерировать криптографический ключ и самоподписанный сертификат безопасности для возможности перехода веб-сервера от работы через протокол HTTP к работе через протокол HTTPS
2. Настроить веб-сервер для работы с PHP
3. Написать (или скорректировать) скрипт для Vagrant, фиксирующий действия по расширенной настройке HTTP-сервера во внутреннем окружении виртуальной машины server

# Выполнение лабораторной работы

## Конфигурирование HTTP-сервера для работы через протокол HTTPS

Загрузили нашу операционную систему и перешли в рабочий каталог с проектом: ```cd /var/tmp/eavernikovskaya/vagrant``` ([рис. @fig-001])

![Рабочий каталог с проектом](image/лаба5_1.png){#fig-001 width=70%}

Запустили виртуальную машину server: ```make server-up``` ([рис. @fig-002]) 

![Запуск виртуальной машины server](image/лаба5_2.png){#fig-002 width=70%}

Далее на виртуальной машине server вошли под созданным нами в предыдущей работе пользователем и открыли терминал. Перешли в режим суперпользователя: ```sudo -i``` ([рис. @fig-003])

![Переход в режим суперпользователя](image/лаба5_3.png){#fig-003 width=70%}

В каталоге */etc/ssl* создали каталог *private*: 

```mkdir -p /etc/pki/tls/private```

```ln -s /etc/pki/tls/private /etc/ssl/private```

```cd /etc/pki/tls/private```([рис. @fig-004])

![Создание каталога private](image/лаба5_4.png){#fig-004 width=70%}

Далее сгенерировали ключ и сертификат, используя команду: 

```openssl req -x509 -nodes -newkey rsa:2048 -keyout www.eavernikovskaya.net.key -out www.eavernikovskaya.net.crt``` ([рис. @fig-005])

И заполнили сертификат:

- в строке кода страны указали RU;
- в строке названия страны указали Russia;
- в строке названия города указали Moscow;
- в строке названия организации указали свой логин - eavernikovskaya;
- в строке названия подразделения указали свой логин - eavernikovskaya;
- в строке названия хоста должно быть указано доменное имя нашего веб-сервера eavernikovskaya.net;
– в строке e-mail адреса должен быть указан eavernikovskaya@eavernikovskaya.net 

![Генерация ключа и сертификата](image/лаба5_5.png){#fig-005 width=70%}

В итоге ключ и сертификат должны быть в соответствующих каталогах */etc/ssl/private/* и */etc/ssl/cert/* ([рис. @fig-006])

![Каталоги для ключа и сертификата](image/лаба5_6.png){#fig-006 width=70%}

Для перехода веб-сервера www.eavernikovskaya.net на функционирование через протокол HTTPS требуется изменить его конфигурационный файл. Перешли в каталог с конфигурационными файлами: ```cd /etc/httpd/conf.d``` ([рис. @fig-007])

![Каталог с конфигурационными файлами](image/лаба5_7.png){#fig-007 width=70%}

Далее заменили содержимое файла */etc/httpd/conf.d/www.eavernikovskaya.net.conf* на следуюущее ([рис. @fig-008]):

```
<VirtualHost *:80>
	ServerAdmin webmaster@eavernikovskaya.net
	DocumentRoot /var/www/html/www.eavernikovskaya.net
	ServerName www.eavernikovskaya.net
	ServerAlias www.eavernikovskaya.net
	ErrorLog logs/www.eavernikovskaya.net-error_log
	CustomLog logs/www.eavernikovskaya.net-access_log common
	RewriteEngine on
	RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]
</VirtualHost>

<IfModule mod_ssl.c>
<VirtualHost *:443>
	SSLEngine on
	ServerAdmin webmaster@eavernikovskaya.net
	DocumentRoot /var/www/html/www.eavernikovskaya.net
	ServerName www.eavernikovskaya.net
	ServerAlias www.eavernikovskaya.net
	ErrorLog logs/www.eavernikovskaya.net-error_log
	CustomLog logs/www.eavernikovskaya.net-access_log common
	SSLCertificateFile /etc/ssl/certs/www.eavernikovskaya.net.crt
	SSLCertificateKeyFile /etc/ssl/private/www.eavernikovskaya.net.key
</VirtualHost>
</IfModule>
```

Пояснения к содержанию файла:

Это конфигурация виртуального хоста Apache для сайта www.eavernikovskaya.net:

- HTTP (порт 80):

	+ Автоматически перенаправляет всех посетителей на HTTPS-версию

- HTTPS (порт 443):

	+ Обслуживает основную версию сайта

	+ Использует SSL-сертификат для безопасного соединения

	+ Корневая директория: /var/www/html/www.eavernikovskaya.net

Файл обеспечивает принудительное использование HTTPS и настройку SSL для домена.

![Содержание файла /etc/httpd/conf.d/www.eavernikovskaya.net.conf](image/лаба5_8.png){#fig-008 width=70%}


Далее внесли изменения в настройки межсетевого экрана на сервере, разрешив работу с https:

```firewall-cmd --list-services```

```firewall-cmd --get-services```

```firewall-cmd --add-service=https```

```firewall-cmd --add-service=https --permanent```

```firewall-cmd --reload``` ([рис. @fig-009])

![Внесение изменений в настройки межсетевого экрана на сервере, разрешив работу с https](image/лаба5_9.png){#fig-009 width=70%}

Далее перезапустили веб-сервер: ```systemctl restart httpd``` ([рис. @fig-010])

![Перезапуск веб-сервера](image/лаба5_10.png){#fig-010 width=70%}

После на виртуальной машине client в строке браузера ввели название веб-сервера www.eavernikovskaya.net и убедились, что произошло автоматическое переключение на работу по протоколу HTTPS. На открывшейся странице с сообщением о незащищённости соединения нажали кнопку «Дополнительно», затем добавили адрес нашего сервера в постоянные исключения ([рис. @fig-011]), ([рис. @fig-012])

![Запуск виртуальной машины client](image/лаба5_11.png){#fig-011 width=70%}

![Добавление адреса в постоянные исключения](image/лаба5_12.png){#fig-012 width=70%}

Затем посмотрели сожержание сертификата (нажали на значок с замком в адресной строке и кнопку «Подробнее») ([рис. @fig-013]), ([рис. @fig-014]), ([рис. @fig-015])

![Просмотр содержания сертификата (1)](image/лаба5_13.png){#fig-013 width=70%}

![Просмотр содержания сертификата (2)](image/лаба5_14.png){#fig-014 width=70%}

![Просмотр содержания сертификата (3)](image/лаба5_15.png){#fig-015 width=70%}

## Конфигурирование HTTP-сервера для работы с PHP

Установили пакеты для работы с PHP: ```dnf -y install php``` ([рис. @fig-016])

![Установка пакетов для работы с PHP](image/лаба5_16.png){#fig-016 width=70%}

Далее в каталоге */var/www/html/www.eavernikovskaya.net* заменили файл *index.html* на *index.php* ([рис. @fig-017])

![Змена файла](image/лаба5_17.png){#fig-017 width=70%}

В нём прописали ([рис. @fig-018]):

```
<?php
phpinfo();
?>
```

![Содержание файла index.php](image/лаба5_18.png){#fig-018 width=70%}

Скорректировали права доступа в каталог с веб-контентом: ```chown -R apache:apache /var/www``` ([рис. @fig-019])

![Корректировка прав доступа в каталог с веб-контентом](image/лаба5_19.png){#fig-019 width=70%}

Далее восстановили контекст безопасности в SELinux:

```restorecon -vR /etc```

``restorecon -vR /var/www``` ([рис. @fig-020])

![Восстановление контекста безопасности в SELinux](image/лаба5_20.png){#fig-020 width=70%}

Перезапустили HTTP-сервер: ```systemctl restart httpd``` ([рис. @fig-021])

![Перезапуск HTTP-сервера](image/лаба5_21.png){#fig-021 width=70%}

Далее на виртуальной машине client в строке браузера введли название веб-сервера www.eavernikovskaya.net и убедились, что была выведена страница с информацией об используемой на веб-сервере версии PHP ([рис. @fig-022])

![Страница об используемой на веб-сервере версии PHP](image/лаба5_22.png){#fig-022 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На виртуальной машине server перешли в каталог для внесения изменений в настройки внутреннего окружения */vagrant/provision/server/http* и в соответствующие каталоги скопировали конфигурационные файлы: 

```cp -R /etc/httpd/conf.d/* /vagrant/provision/server/http/etc/httpd/conf.d```

```cp -R /var/www/html/* /vagrant/provision/server/http/var/www/html```

```mkdir -p /vagrant/provision/server/http/etc/pki/tls/private```

```mkdir -p /vagrant/provision/server/http/etc/pki/tls/certs```

```cp -R /etc/pki/tls/private/www.user.net.key /vagrant/provision/server/http/etc/pki/tls/private```

```cp -R /etc/pki/tls/certs/www.user.net.crt /vagrant/provision/server/http/etc/pki/tls/certs``` ([рис. @fig-023])

![Копирование конфигурационных файлов](image/лаба5_23.png){#fig-023 width=70%}

В имеющийся скрипт */vagrant/provision/server/http.sh* внесли изменения, добавив установку PHP и настройку межсетевого экрана, разрешающую работать с https ([рис. @fig-024]):

```
#!/bin/bash
echo "Provisioning script $0"
echo "Install needed packages"
dnf -y groupinstall "Basic Web Server"
dnf -y install php
echo "Copy configuration files"
cp -R /vagrant/provision/server/http/etc/httpd/* /etc/httpd
cp -R /vagrant/provision/server/http/var/www/* /var/www
cp -R /vagrant/provision/server/http/etc/tls/* /ets/tls
chown -R apache:apache /var/www
restorecon -vR /etc
restorecon -vR /var/www
echo "Configure firewall"
firewall-cmd --add-service=http
firewall-cmd --add-service=http --permanent
firewall-cmd --add-service=https
firewall-cmd --add-service=https --permanent
firewall-cmd --reload
echo "Start http service"
systemctl enable httpd
systemctl start httpd
```

![Редактирование скрипта http.sh](image/лаба5_24.png){#fig-024 width=70%}

После этого можно выключать виртуальные машины server и cliet: ```make server-halt``` и ```make client-halt``` ([рис. @fig-025])

![Выключение виртуальных машин server и client](image/лаба5_25.png){#fig-025 width=70%}

## Контрольные вопросы + ответы

1. В чём отличие HTTP от HTTPS?

HTTP (HyperText Transfer Protocol) – это протокол передачи данных, который используется для передачи информации между клиентом (например, веб-браузером) и сервером. Однако он не обеспечивает шифрование данных, что делает их уязвимыми к перехвату злоумышленниками.

HTTPS (HyperText Transfer Protocol Secure) - это расширение протокола HTTP с добавлением шифрования, обеспечивающее безопасную передачу данных между клиентом и сервером. Протокол HTTPS использует SSL (Secure Sockets Layer) или более современный TLS (Transport Layer Security) для шифрования данных.

2. Каким образом обеспечивается безопасность контента веб-сервера при работе через HTTPS?

Шифрование данных: при использовании HTTPS данные, передаваемые между клиентом и сервером, шифруются, что делает их невозможными для прочтения злоумышленниками, перехватывающими трафик.

Идентификация сервера: сервер предоставляет цифровой сертификат, подтверждающий его легитимность. Этот сертификат выдается сертификационным центром и содержит информацию о владельце сертификата, публичный ключ для шифрования и подпись, подтверждающую подлинность сертификата.

3. Что такое сертификационный центр? Приведите пример.

Определение: сертификационный центр (Центр сертификации) - это доверенная сторона, которая выдает цифровые сертификаты, подтверждающие подлинность владельца сертификата.

Пример: Одним из известных сертификационных центров является "Let's Encrypt". Он предоставляет бесплатные SSL-сертификаты, которые используются для обеспечения безопасного соединения на множестве веб-сайтов. Владельцы веб-сайтов могут получить сертификат от Let's Encrypt, чтобы обеспечить шифрование и подтвердить свою легитимность в онлайн-среде.

# Выводы

В ходе выполнения лабораторной работы №5 мы приобрели практические навыки по расширенному конфигурированию HTTPсервера Apache в части безопасности и возможности использования PHP.

# Список литературы

1. [Лаборатораня работа №5](https://esystem.rudn.ru/pluginfile.php/2854748/mod_resource/content/8/005-http-adv.pdf)
