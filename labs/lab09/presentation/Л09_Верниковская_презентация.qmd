---
# Preamble

## Author
author:
  name: Верниковская Екатерина Андреевна
  degrees: DSc
  email: 11322361366@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: Презентация по лабораторной работе №9
subtitle: Администрирование сетевых подсистем
license: CC BY
date: 2025-10-26

## Generic options
lang: ru-RU
crossref:
  lof-title: Список иллюстраций
  lot-title: Список таблиц
  lol-title: Листинги

## Fonts 
mainfont: PT Serif 
romanfont: PT Serif 
sansfont: PT Sans 
monofont: PT Mono 
mainfontoptions: Ligatures=TeX 
romanfontoptions: Ligatures=TeX 
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase 
monofontoptions: Scale=MatchLowercase,Scale=0.9

## Formats
format:
### Pdf output format
  beamer:
    toc: true
    toc-title: Содержание
    number-sections: true
    colorlinks: false
    toc-depth: 2
    slide_level: 2
    aspectratio: 169
    section-titles: true
    theme: metropolis
    themeoptions: progressbar=frametitle,sectionpage=progressbar,numbering=fraction
    pdf-engine: xelatex
    fontenc: T2A
#### Language
    babel-lang: russian
    babel-otherlangs: english

### Html output
  revealjs:
    transition: slide
    margin: 0.2
    smaller: false
    output-ext: html
    theme: beige
    logo: _resources/image/logo_rudn.png
---

# Вводная часть

## Цель работы

Целью данной работы является приобретение практических навыков по установке и простейшему конфигурированию POP3/IMAP-сервера.

## Задание

1. Установить на виртуальной машине server Dovecot и Telnet для дальнейшей проверки корректности работы почтового сервера
2. Настроить Dovecot
3. Установить на виртуальной машине client программу для чтения почты Evolution
и настроить её для манипуляций с почтой вашего пользователя. Проверить корректность работы почтового сервера как с виртуальной машины server, так и с виртуальной машины client
4. Изменить скрипт для Vagrant, фиксирующий действия по установке и настройке Postfix и Dovecote во внутреннем окружении виртуальной машины server, создать скрипт для Vagrant, фиксирующий действия по установке Evolution во внутреннем окружении виртуальной машины client. Соответствующим образом внести изменения в Vagrantfile

# Выполнение лабораторной работы

## Установка Dovecot

Загрузили нашу операционную систему и перешли в рабочий каталог с проектом: ```cd /var/tmp/eavernikovskaya/vagrant``` ([рис. @fig-001])

![Рабочий каталог с проектом](image/лаба9_1.png){#fig-001 width=70%}

## Установка Dovecot

Запустили виртуальную машину server: ```make server-up``` ([рис. @fig-002]) 

![Запуск виртуальной машины server](image/лаба9_2.png){#fig-002 width=70%}

## Установка Dovecot

Далее на виртуальной машине server вошли под созданным нами в предыдущей работе пользователем и открыли терминал. Перешли в режим суперпользователя: ```sudo -i``` ([рис. @fig-003])

![Переход в режим суперпользователя на server](image/лаба9_3.png){#fig-003 width=70%}

## Установка Dovecot

Далее установили необходимые для работы пакеты: ```dnf -y install dovecot telnet``` ([рис. @fig-004])

![Установка dovecot и telnet](image/лаба9_4.png){#fig-004 width=70%}

## Настройка dovecot

В конфигурационном файле */etc/dovecot/dovecot.conf* прописали список почтовых протоколов, по которым разрешено работать Dovecot: ```protocols = imap pop3``` ([рис. @fig-005])

![Редактирование файла /etc/dovecot/dovecot.conf](image/лаба9_5.png){#fig-005 width=70%}

## Настройка dovecot

В конфигурационном файле */etc/dovecot/conf.d/10-auth.conf* проверили, что указан метод аутентификации plain: ```auth_mechanisms = plain``` ([рис. @fig-006])

![Проверка файла /etc/dovecot/conf.d/10-auth.conf](image/лаба9_6.png){#fig-006 width=70%}

## Настройка dovecot

В конфигурационном файле */etc/dovecot/conf.d/auth-system.conf.ext* проверили, что для поиска пользователей и их паролей используется pam и файл passwd ([рис. @fig-007]), ([рис. @fig-008]):

![Проверка файла /etc/dovecot/conf.d/auth-system.conf.ext (1)](image/лаба9_7.png){#fig-007 width=70%}

## Настройка dovecot

![Проверка файла /etc/dovecot/conf.d/auth-system.conf.ext (2)](image/лаба9_8.png){#fig-008 width=60%}

## Настройка dovecot

В конфигурационном файле */etc/dovecot/conf.d/10-mail.conf* настроили месторасположение почтовых ящиков пользователей: ```mail_location = maildir:~/Maildir``` ([рис. @fig-009])

![Редактирование файла /etc/dovecot/conf.d/10-mail.conf](image/лаба9_9.png){#fig-009 width=70%}

## Настройка dovecot

В Postfix задали каталог для доставки почты: ```postconf -e 'home_mailbox = Maildir/'``` ([рис. @fig-010])

![Задание каталога для доставки почты](image/лаба9_10.png){#fig-010 width=70%}

## Настройка dovecot

Далее сконфигурировали межсетевой экран, разрешив работать службам протоколов POP3 и IMAP ([рис. @fig-011]):

![Конфигурация межсетевого экрана, разрешение работать службам протоколов POP3 и IMAP](image/лаба9_11.png){#fig-011 width=50%}

## Настройка dovecot

Восстановили контекст безопасности в SELinux: ```restorecon -vR /etc``` ([рис. @fig-012])

![Восстановление контекста безопасности в SELinux](image/лаба9_12.png){#fig-012 width=70%}

## Настройка dovecot

Перезапустили Postfix и запустили Dovecot ([рис. @fig-013]):

![Перезапуск Postfix и запуск Dovecot](image/лаба9_13.png){#fig-013 width=70%}

## Проверка работы Dovecot

На дополнительном терминале виртуальной машины server запустили мониторинг работы почтовой службы: ```tail -f /var/log/maillog``` ([рис. @fig-014])

![Мониторинг работы почтовой службы](image/лаба9_14.png){#fig-014 width=70%}

## Проверка работы Dovecot

На терминале сервера для просмотра имеющейся почты использовали ```MAIL=~/Maildir mail``` ([рис. @fig-015])

![Просмотр имеющейся почты](image/лаба9_15.png){#fig-015 width=70%}

## Проверка работы Dovecot

Для просмотра mailbox пользователя на сервере на терминале с правами суперпользователя использовали команду ```doveadm mailbox list -u eavernikovskaya``` ([рис. @fig-016])

![Просмотр mailbox](image/лаба9_16.png){#fig-016 width=70%}

## Проверка работы Dovecot

Далее загрузили виртуальную машину client, вошли под нашим пользователем и открыли терминал. Там перешли в режим суперпользователя ([рис. @fig-017]), ([рис. @fig-018])

![Запуск виртуальной машины client](image/лаба9_17.png){#fig-017 width=70%}

## Проверка работы Dovecot

![Переход в режим суперпользователя на client](image/лаба9_18.png){#fig-018 width=70%}

## Проверка работы Dovecot

Установили почтовый клиент: ```dnf -y install evolution``` ([рис. @fig-019])

![Установка почтового клиента на client](image/лаба9_19.png){#fig-019 width=70%}

## Проверка работы Dovecot

Запустили и настроили почтовый клиент Evolution ([рис. @fig-020]), ([рис. @fig-021]), ([рис. @fig-022]), ([рис. @fig-023]), ([рис. @fig-024]), ([рис. @fig-025]), ([рис. @fig-026])

![Запуск почтового клиента Evolution](image/лаба9_20.png){#fig-020 width=70%}

## Проверка работы Dovecot

![Настройка почтового клиента Evolution (1)](image/лаба9_21.png){#fig-021 width=70%}

## Проверка работы Dovecot

![Настройка почтового клиента Evolution (2)](image/лаба9_22.png){#fig-022 width=70%}

## Проверка работы Dovecot

![Настройка почтового клиента Evolution (3)](image/лаба9_23.png){#fig-023 width=70%}

## Проверка работы Dovecot

![Настройка почтового клиента Evolution (4)](image/лаба9_24.png){#fig-024 width=70%}

## Проверка работы Dovecot

![Настройка почтового клиента Evolution (5)](image/лаба9_25.png){#fig-025 width=70%}

## Проверка работы Dovecot

![Настройка почтового клиента Evolution (6)](image/лаба9_26.png){#fig-026 width=70%}

## Проверка работы Dovecot

Из почтового клиента отправили себе несколько тестовых писем, убедились, что они доставлены ([рис. @fig-027]), ([рис. @fig-028]), ([рис. @fig-029]), ([рис. @fig-030]), ([рис. @fig-031]), ([рис. @fig-032]), ([рис. @fig-033])

![Отправка себе тестового письма из почтового клиента (1)](image/лаба9_27.png){#fig-027 width=40%}

## Проверка работы Dovecot

![Отправка себе тестового письма из почтового клиента (2)](image/лаба9_28.png){#fig-028 width=50%}

## Проверка работы Dovecot

![Отправка себе тестового письма из почтового клиента (3)](image/лаба9_29.png){#fig-029 width=50%}

## Проверка работы Dovecot

![Проверка того что письма доставлены](image/лаба9_30.png){#fig-030 width=70%}

## Проверка работы Dovecot

![Доставленное тестовое письмо (1)](image/лаба9_31.png){#fig-031 width=70%}

## Проверка работы Dovecot

![Доставленное тестовое письмо (2)](image/лаба9_32.png){#fig-032 width=70%}

## Проверка работы Dovecot

![Доставленное тестовое письмо (3)](image/лаба9_33.png){#fig-033 width=70%}

## Проверка работы Dovecot

Параллельно посмотрели, какие сообщения выдаются при мониторинге почтовой службы на сервере, а также при использовании doveadm и mail ([рис. @fig-034]), ([рис. @fig-035]), ([рис. @fig-036])

![Мониторинг работы почтовой службы после отправки тестовых писем](image/лаба9_34.png){#fig-034 width=70%}

## Проверка работы Dovecot

![Просмотр имеющейся почты после отправки тестовых писем](image/лаба9_35.png){#fig-035 width=70%}

## Проверка работы Dovecot

![Просмотр mailbox после отправки тестовых писем](image/лаба9_36.png){#fig-036 width=70%}

## Проверка работы Dovecot

Далее проверили работу почтовой службы, используя на сервере протокол Telnet. Подключились с помощью протокола Telnet к почтовому серверу по протоколу POP3 (через порт 110), ввели свой логин для подключения и пароль ([рис. @fig-037]):

![Подключение к почтовому серверу с помощью протокола Telnet](image/лаба9_37.png){#fig-037 width=70%}

## Проверка работы Dovecot

Далее использовали команды ```list```, ```retr 1```, ```dele 2``` и ```quit``` ([рис. @fig-038])

![Работа с почтовым сервером через Telnet](image/лаба9_38.png){#fig-038 width=50%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На виртуальной машине server перешлм в каталог для внесения изменений в настройки внутреннего окружения */vagrant/provision/server/* и соответствующие подкаталоги поместили конфигурационные файлы Dovecot: ([рис. @fig-039]):

![Копирование конфигурационных файлов Dovecot в каталог dovecot](image/лаба9_39.png){#fig-039 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Далее внесли изменения в файл */vagrant/provision/server/mail.sh*, добавив в него строки по устанвке Dovecot и Telnet, по настройке межсетевого экрана,по настройке Postfix в части задания месторасположения почтового ящика, по перезапуску Postfix и запуску Dovecot ([рис. @fig-040])

## Внесение изменений в настройки внутреннего окружения виртуальной машины

![Редактирование файла mail.sh на сервере](image/лаба9_40.png){#fig-040 width=40%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На виртуальной машине client в каталоге */vagrant/provision/client* скорректировали файл *mail.sh*, прописав в нём ```dnf -y install evolution``` ([рис. @fig-041]): 

![Редактирование файла mail.sh на клиенте](image/лаба9_41.png){#fig-041 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

После этого можно выключать виртуальные машины server и client: ```make server-halt``` и ```make client-halt``` ([рис. @fig-042])

![Выклчение виртуальных машин server и client](image/лаба9_42.png){#fig-042 width=70%}

# Подведение итогов

## Выводы

В ходе выполнения лабораторной работы №9 мы приобрели практические навыки по установке и простейшему конфигурированию POP3/IMAP-сервера.

## Список литературы

1. [Лаборатораня работа №9](https://esystem.rudn.ru/pluginfile.php/2854766/mod_resource/content/6/009-imap.pdf)
