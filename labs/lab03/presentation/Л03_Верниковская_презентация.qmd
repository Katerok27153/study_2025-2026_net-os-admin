---
# Preamble

## Author
author:
  name: Верниковская Екатерина Андреевна
  degrees: DSc
  email: 11322361366@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: Отчёт по лабораторной работе №3
subtitle: Администрирование сетевых подсистем
license: CC BY
date: 2025-9-17

## Generic options
lang: ru-RU
crossref:
  lof-title: Список иллюстраций
  lot-title: Список таблиц
  lol-title: Листинги

## Fonts 
mainfont: PT Serif 
romanfont: PT Serif 
sansfont: PT Sans 
monofont: PT Mono 
mainfontoptions: Ligatures=TeX 
romanfontoptions: Ligatures=TeX 
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase 
monofontoptions: Scale=MatchLowercase,Scale=0.9

## Formats
format:
### Pdf output format
  beamer:
    toc: true
    toc-title: Содержание
    number-sections: true
    colorlinks: false
    toc-depth: 2
    slide_level: 2
    aspectratio: 169
    section-titles: true
    theme: metropolis
    themeoptions: progressbar=frametitle,sectionpage=progressbar,numbering=fraction
    pdf-engine: xelatex
    fontenc: T2A
#### Language
    babel-lang: russian
    babel-otherlangs: english

### Html output
  revealjs:
    transition: slide
    margin: 0.2
    smaller: false
    output-ext: html
    theme: beige
    logo: _resources/image/logo_rudn.png
---

# Вводная часть

## Цель работы

Целью данной работы является приобретение практических навыков по установке и конфигурированию DHCP-сервера.

## Задание

1. Установить на виртуальной машине server DHCP-сервер 
2. Настроить виртуальную машину server в качестве DHCP-сервера для виртуальной внутренней сети
3. Проверить корректность работы DHCP-сервера в виртуальной внутренней сети
путём запуска виртуальной машины client и применения соответствующих утилит диагностики
4. Настроить обновление DNS-зоны при появлении в виртуальной внутренней сети новых узлов 
5. Проверить корректность работы DHCP-сервера и обновления DNS-зоны в виртуальной внутренней сети путём запуска виртуальной машины client и применения соответствующих утилит диагностики
6. Написать скрипт для Vagrant, фиксирующий действия по установке и настройке DHCP-сервера во внутреннем окружении виртуальной машины server

# Выполнение лабораторной работы

## Установка DHCP-сервера

Загрузили нашу операционную систему и перешли в рабочий каталог с проектом: ```cd /var/tmp/eavernikovskaya/vagrant``` ([рис. @fig-001])

![Рабочий каталог с проектом](image/лаба3_1.png){#fig-001 width=70%}

## Установка DHCP-сервера

Запустили виртуальную машину server: ```make server-up``` ([рис. @fig-002]) 

![Запуск виртуальной машины server](image/лаба3_2.png){#fig-002 width=70%}

## Установка DHCP-сервера

Далее на виртуальной машине server вошли под созданным нами в предыдущей работе пользователем и открыли терминал. Перешли в режим суперпользователя: ```sudo -i``` ([рис. @fig-003])

![Переход в режим суперпользователя](image/лаба3_3.png){#fig-003 width=70%}

## Установка DHCP-сервера

Далее установили dhcp: ```dnf -y install dhcp``` ([рис. @fig-004])

![Установка dhcp](image/лаба3_4.png){#fig-004 width=70%}

## Конфигурирование DHCP-сервера

Далее сохранили на всякий случай конфигурационный файл: ```cp /etc/kea/kea-dhcp4.conf /etc/kea/kea-dhcp4.conf__$(date -I)``` ([рис. @fig-005])

![Сохранение файла kea-dhcp4.conf](image/лаба3_5.png){#fig-005 width=70%}

## Конфигурирование DHCP-сервера

Далее открыли файл */etc/kea/kea-dhcp4.conf* на редактирование. В этом файле заменили шаблон для domain-name и прописали в описании следующие строчки ([рис. @fig-006]):

![Редактирование файла kea-dhcp4.conf (1)](image/лаба3_6.png){#fig-006 width=70%}

## Конфигурирование DHCP-сервера

Также прописали блок ([рис. @fig-007]):

![Редактирование файла kea-dhcp4.conf (2)](image/лаба3_7.png){#fig-007 width=70%}

## Конфигурирование DHCP-сервера

После задали собственную конфигурацию dhcp-сети, задав адрес подсети, диапазон адресов для распределения клиентам, адрес маршрутизатора и broadcast-адрес, а остальные примеры задания конфигураций подсетей удалили ([рис. @fig-008]):

## Конфигурирование DHCP-сервера

![Редактирование файла kea-dhcp4.conf (3)](image/лаба3_8.png){#fig-008 width=40%}

## Конфигурирование DHCP-сервера

Также настроили привязку dhcpd к интерфейсу eth1 виртуальной машины server ([рис. @fig-009]):

![Редактирование файла kea-dhcp4.conf (4)](image/лаба3_9.png){#fig-009 width=70%}

## Конфигурирование DHCP-сервера

Далее проверилили правильность конфигурационного файла: ```kea-dhcp4 -t /etc/kea/kea-dhcp4.conf``` ([рис. @fig-010])

![Проверка правильности файла kea-dhcp4.conf](image/лаба3_10.png){#fig-010 width=70%}

## Конфигурирование DHCP-сервера

Перезагрузили конфигурацию dhcpd и разрешили загрузку DHCP-сервера при запуске виртуальной машины server: ```systemctl --system daemon-reload``` и ```systemctl enable kea-dhcp4.service``` ([рис. @fig-011])

![Перезагрузка конфигурации и разрешение загрузки DHCP-сервера при запуске виртуальной машины server](image/лаба3_11.png){#fig-011 width=70%}

## Конфигурирование DHCP-сервера

Далее добавили запись для DHCP-сервера в конце файла прямой DNS-зоны */var/named/primary/fz/eavernikovskaya.net*: ```dhcp A 192.168.1.1``` ([рис. @fig-012])

![Редактирование файла прямой DNS-зоны](image/лаба3_12.png){#fig-012 width=70%}

## Конфигурирование DHCP-сервера

А в конце файла обратной DNS-зоны */var/named/master/rz/192.168.1* добавили: ```1 PTR dhcp.eavernikovskaya.net.``` ([рис. @fig-013])

![Редактирование файла обратной DNS-зоны](image/лаба3_13.png){#fig-013 width=70%}

## Конфигурирование DHCP-сервера

Перезапустили named: ```systemctl restart named``` ([рис. @fig-014])

![Перезапуск named](image/лаба3_14.png){#fig-014 width=70%}

## Конфигурирование DHCP-сервера

Далее проверили что можно обратиться к DHCP-серверу по имени: ```ping dhcp.eavernikovskaya.net``` ([рис. @fig-015])

![Проверка команды ping dhcp.eavernikovskaya.net](image/лаба3_15.png){#fig-015 width=70%}

## Конфигурирование DHCP-сервера

Внесли изменеия в настройки межсетевого экрана узла server, разрешив работу с DHCP с помощью команд: ```firewall-cmd --list-services```, ```firewall-cmd --get-services```, ```firewall-cmd --add-service=dhcp``` и ```firewall-cmd --add-service=dhcp --permanent``` ([рис. @fig-016])

## Конфигурирование DHCP-сервера

![Внесение изменений в настройки межсетевого экрана узла server, разрешив работу с DHCP](image/лаба3_16.png){#fig-016 width=60%}

## Конфигурирование DHCP-сервера

Далее восстановили контекст безопасности в SELinux: ```restorecon -vR /etc```, ```restorecon -vR /var/named``` и ```restorecon -vR /var/lib/kea/``` ([рис. @fig-017])

![Восстановление контекста безопасности в SELinux](image/лаба3_17.png){#fig-017 width=70%}

## Конфигурирование DHCP-сервера

В дополнительном терминале запустили мониторинг происходящих в системе процессов в реальном времени: ```journalctl -u kea-dhcp4 -f``` ([рис. @fig-018])

![Мониторинг процессов](image/лаба3_18.png){#fig-018 width=70%}

## Конфигурирование DHCP-сервера

В основном рабочем терминале запустили DHCP-сервер: ```systemctl start kea-dhcp4.service``` ([рис. @fig-019])

![Запуск DHCP-сервера](image/лаба3_19.png){#fig-019 width=70%}

## Анализ работы DHCP-сервера

Перед запуском виртуальной машины client в каталоге с проектом в нашей операционной системе в подкаталоге *vagrant/provision/client* создали файл *01-routing.sh* со следующим скриптом ([рис. @fig-020]):

![Файл 01-routing.sh](image/лаба3_20.png){#fig-020 width=60%}

## Анализ работы DHCP-сервера

В *Vagrantfile* подключили этот скрипт в разделе конфигурации для клиента ([рис. @fig-021]):

![Подключение скрипта в файл Vagrantfile](image/лаба3_21.png){#fig-021 width=70%}

## Анализ работы DHCP-сервера

Зафиксировали внесённые изменения для внутренних настроек виртуальной машины client и запустили её, введя в терминале: ```make client-provision``` ([рис. @fig-022])

![Запуск виртуальной машины client](image/лаба3_22.png){#fig-022 width=70%}

## Анализ работы DHCP-сервера

Вошли в систему виртуальной машины client под нашим пользователем и в терминале ввели ```ifconfig```. На экран вывелась информация об имеющихся сетевых интерфейсах ([рис. @fig-023])

## Анализ работы DHCP-сервера

![Имеющиеся интерфейсы](image/лаба3_23.png){#fig-023 width=50%}

## Анализ работы DHCP-сервера

На машине server посмотрели список выданных адресов с помощью ```cat /var/lib/kea/kea-leases4.csv``` ([рис. @fig-024])

![Список выданных адресов](image/лаба3_24.png){#fig-024 width=70%}

##  Настройка обновления DNS-зоны

Создали ключ на сервере с Bind9 (на виртуальной машине server): ```mkdir -p /etc/named/keys``` и 
```tsig-keygen -a HMAC-SHA512 DHCP_UPDATER > /etc/named/keys/dhcp_updater.key``` ([рис. @fig-025])

![Создание ключа на сервере с Bind9](image/лаба3_25.png){#fig-025 width=70%}

##  Настройка обновления DNS-зоны

Далее посмотрели файл */etc/named/keys/dhcp_updater.key* ([рис. @fig-026])

![Файл dhcp_updater.key](image/лаба3_26.png){#fig-026 width=70%}

##  Настройка обновления DNS-зоны

Поправили права досутпа: ```chown -R named:named /etc/named/keys``` ([рис. @fig-027])

![Поправка прав доступа директории /etc/named/keys](image/лаба3_27.png){#fig-027 width=70%}

##  Настройка обновления DNS-зоны

В файле */etc/named.conf* подключили ключ: ```include "/etc/named/keys/dhcp_updater.key";``` ([рис. @fig-028])

![Подключение ключа в файле /etc/named.conf](image/лаба3_28.png){#fig-028 width=70%}

##  Настройка обновления DNS-зоны

Далее на виртуальной машине server под пользователем с правами суперпользователя отредактировали файл */etc/named/eavernikovskaya.net*, разрешив обновление зоны ([рис. @fig-029]):

##  Настройка обновления DNS-зоны

![Редактирование файла /etc/named/eavernikovskaya.net](image/лаба3_29.png){#fig-029 width=50%}

##  Настройка обновления DNS-зоны

Далее сделали проверку конфигурационного файла: ```named-checkconf``` ([рис. @fig-030])

![Проверка конфигурационного файла](image/лаба3_30.png){#fig-030 width=70%}

##  Настройка обновления DNS-зоны

После перезапустили DNS-сервер: ```systemctl restart named``` ([рис. @fig-031])

![Перезапуск DNS-сервера](image/лаба3_31.png){#fig-031 width=70%}

##  Настройка обновления DNS-зоны

Сформировали ключ для Kea. Файл клча назовём */etc/kea/tsig-keys.json*: ```touch /etc/kea/tsig-keys.json``` ([рис. @fig-032])

![Создание файла ключа](image/лаба3_32.png){#fig-032 width=70%}

##  Настройка обновления DNS-зоны

Далее перенесли ключ на сервер Kea DHCP и переписали его в формате json ([рис. @fig-033]):

![Редактирование файла ключа](image/лаба3_33.png){#fig-033 width=70%}

##  Настройка обновления DNS-зоны

Сменили владельца: ```chown kea:kea /etc/kea/tsig-keys.json``` ([рис. @fig-034])

![Смена владельца файла tsig-keys.json](image/лаба3_34.png){#fig-034 width=70%}

##  Настройка обновления DNS-зоны

Поправили права доступа: ```chmod 640 /etc/kea/tsig-keys.json``` ([рис. @fig-035])

![Поправка правд доступа для файла tsig-keys.json](image/лаба3_35.png){#fig-035 width=70%}

##  Настройка обновления DNS-зоны

Далее отредактиовали файл */etc/kea/kea-dhcp-ddns.conf* ([рис. @fig-036]):

##  Настройка обновления DNS-зоны

![Редактирование файла /etc/kea/kea-dhcp-ddns.conf](image/лаба3_36.png){#fig-036 width=50%}

##  Настройка обновления DNS-зоны

Изменили владельца файла: chown ```kea:kea /etc/kea/kea-dhcp-ddns.conf``` ([рис. @fig-037])

![Смена владельца файла kea-dhcp-ddns.conf](image/лаба3_37.png){#fig-037 width=70%}

##  Настройка обновления DNS-зоны

И проверили файл на наличие возможных синтаксических ошибок: ```kea-dhcp-ddns -t /etc/kea/kea-dhcp-ddns.conf``` ([рис. @fig-038])

![Проверка файла kea-dhcp-ddns.conf на синтаксические ошибки](image/лаба3_38.png){#fig-038 width=70%}

##  Настройка обновления DNS-зоны

Далее запустили службы ddns: ```systemctl enable --now kea-dhcp-ddns.service``` ([рис. @fig-039])

![Запуск службы ddns](image/лаба3_39.png){#fig-039 width=70%}

##  Настройка обновления DNS-зоны

После проверили статус службы: ```systemctl status kea-dhcp-ddns.service``` ([рис. @fig-040])

![Статус службы ddns](image/лаба3_40.png){#fig-040 width=70%}

##  Настройка обновления DNS-зоны

Далее внесли изменения в конфигурационный файл */etc/kea/kea-dhcp4.conf*, добавив в него разрешение на динамическое обновление DNS-записей с локального узла прямой и обратной зон ([рис. @fig-041]):

![Редактирование файла kea-dhcp4.conf (5)](image/лаба3_41.png){#fig-041 width=70%}

##  Настройка обновления DNS-зоны

Далее проверили файл на наличие возможных синтаксических ошибок: ```kea-dhcp4 -t /etc/kea/kea-dhcp4.conf``` ([рис. @fig-042])

![Проверка файла kea-dhcp4.conf на синтаксические ошибки](image/лаба3_42.png){#fig-042 width=70%}

##  Настройка обновления DNS-зоны

Перезапустили DHCP-сервер: ```systemctl restart kea-dhcp4.service``` ([рис. @fig-043])

![Перезаупск DHCP-сервера](image/лаба3_43.png){#fig-043 width=70%}

##  Настройка обновления DNS-зоны

Поверили статус: ```systemctl status kea-dhcp4.service``` ([рис. @fig-044])

![Статус DHCP-сервера](image/лаба3_44.png){#fig-044 width=70%}

##  Настройка обновления DNS-зоны

Далее на машине client переполучили адрес: ```nmcli connection down eth1``` и ```nmcli connection up eth1``` ([рис. @fig-045])

![Получение адреса на машине client](image/лаба3_45.png){#fig-045 width=70%}

##  Настройка обновления DNS-зоны

В каталоге прямой DNS-зоны */var/named/primary/fz* появился файл *eavernikovskaya.net.jnl*, в котором в бинарном файле автоматически вносятся изменения записей зоны ([рис. @fig-046])

![Файл eavernikovskaya.net.jnl](image/лаба3_46.png){#fig-046 width=70%}

## Анализ работы DHCP-сервера после настройки обновления DNS-зоны

На виртуальной машине client с помощью утилиты *dig* убедимся в наличии DNS-записи о клиенте в прямой DNS-зоне: ```dig @192.168.1.1 client.eavernikovskaya.net``` ([рис. @fig-047])

![Выполнение команды dig @192.168.1.1 client.eavernikovskaya.net](image/лаба3_47.png){#fig-047 width=50%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На виртуальной машине server перешли в каталог для внесения изменений в настройки внутреннего окружения */vagrant/provision/server/*, создали в нём каталог *dhcp*, в который поместили в соответствующие подкаталоги конфигурационные файлы DHCP ([рис. @fig-048])

![Создание каталога dhcp, его подкаталогов и копирование туда конфигурационных файлов DHCP](image/лаба3_48.png){#fig-048 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Далее заменили конфигурационные файлы DNS-сервера ([рис. @fig-049])

![Замена конфигурационных файлов DNS-сервера](image/лаба3_49.png){#fig-049 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

В каталоге */vagrant/provision/server* создали исполняемый файл *dhcp.sh* ([рис. @fig-050])

![Создание файла dhcp.sh](image/лаба3_50.png){#fig-050 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Далее отредактируем файл *dhcp.sh* и пропишем в нём следующий скрипт ([рис. @fig-051]): 

![Скрипт в файле dhcp.sh](image/лаба3_51.png){#fig-051 width=50%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Для отработки созданного скрипта во время загрузки виртуальной машины server в конфигурационном файле *Vagrantfile* необходимо добавить в разделе конфигурации для сервера ([рис. @fig-052]):

![Редактирование Vagrantfile](image/лаба3_52.png){#fig-052 width=50%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

После этого выклчили виртуальные машины server и client ([рис. @fig-053])

![Выключение виртуальных машин server и client](image/лаба3_53.png){#fig-053 width=70%}

# Подведение итогов

## Выводы

В ходе выполнения лабораторной работы №3 мы приобрели практические навыки по установке и конфигурированию DHCP-сервера.

## Список литературы

1. [Лаборатораня работа №3](https://esystem.rudn.ru/pluginfile.php/2854738/mod_resource/content/8/003-dhcp.pdf)
