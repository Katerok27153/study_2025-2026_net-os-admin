---
# Preamble

## Author
author:
  name: Верниковская Екатерина Андреевна
  degrees: DSc
  email: 11322361366@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: Презентация по лабораторной работе №7
subtitle: Администрирование сетевых подсистем
license: CC BY
date: 2025-10-05

## Generic options
lang: ru-RU
crossref:
  lof-title: Список иллюстраций
  lot-title: Список таблиц
  lol-title: Листинги

## Fonts 
mainfont: PT Serif 
romanfont: PT Serif 
sansfont: PT Sans 
monofont: PT Mono 
mainfontoptions: Ligatures=TeX 
romanfontoptions: Ligatures=TeX 
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase 
monofontoptions: Scale=MatchLowercase,Scale=0.9

## Formats
format:
### Pdf output format
  beamer:
    toc: true
    toc-title: Содержание
    number-sections: true
    colorlinks: false
    toc-depth: 2
    slide_level: 2
    aspectratio: 169
    section-titles: true
    theme: metropolis
    themeoptions: progressbar=frametitle,sectionpage=progressbar,numbering=fraction
    pdf-engine: xelatex
    fontenc: T2A
#### Language
    babel-lang: russian
    babel-otherlangs: english

### Html output
  revealjs:
    transition: slide
    margin: 0.2
    smaller: false
    output-ext: html
    theme: beige
    logo: _resources/image/logo_rudn.png
---

# Вводная часть

## Цель работы

Целью данной работы является получение навыков настройки межсетевого экрана в Linux в части переадресации портов и настройки Masquerading.

## Задание

1. Настроить межсетевой экран виртуальной машины server для доступа к серверу по протоколу SSH не через 22-й порт, а через порт 2022 
2. Настроить Port Forwarding на виртуальной машине server
3. Настроить маскарадинг на виртуальной машине server для организации доступа клиента к сети Интернет 
4. Написать скрипт для Vagrant, фиксирующий действия по расширенной настройке межсетевого экрана. Соответствующим образом внести изменения в Vagrantfile

# Выполнение лабораторной работы

## Создание пользовательской службы firewalld

Загрузили нашу операционную систему и перешли в рабочий каталог с проектом: ```cd /var/tmp/eavernikovskaya/vagrant``` ([рис. @fig-001])

![Рабочий каталог с проектом](image/лаба7_1.png){#fig-001 width=70%}

## Создание пользовательской службы firewalld

Запустили виртуальную машину server: ```make server-up``` ([рис. @fig-002]) 

![Запуск виртуальной машины server](image/лаба7_2.png){#fig-002 width=70%}

## Создание пользовательской службы firewalld

Далее на виртуальной машине server вошли под созданным нами в предыдущей работе пользователем и открыли терминал. Перешли в режим суперпользователя: ```sudo -i``` ([рис. @fig-003])

![Переход в режим суперпользователя](image/лаба7_3.png){#fig-003 width=70%}

## Создание пользовательской службы firewalld

Далее на основе существующего файла описания службы ssh создали файл с собственным описанием: ```cp /usr/lib/firewalld/services/ssh.xml /etc/firewalld/services/ssh-custom.xml``` ([рис. @fig-004])

![Создание файла описания службы ssh с собственным описанием](image/лаба7_4.png){#fig-004 width=70%}

## Создание пользовательской службы firewalld

Далее посмотрели содержимое файла службы: ```cat /etc/firewalld/services/ssh-custom.xml```([рис. @fig-005])

![Содержимое файла службы](image/лаба7_5.png){#fig-005 width=70%}

## Создание пользовательской службы firewalld

Далее открыли файл описания службы на редактирование и заменили порт 22 на новый порт (2022): ```<port protocol="tcp" port="2022"/>```. В этом же файле скорректировали описание службы, указал что это модифицированный файл службы ([рис. @fig-006])

![Редактирование файла описания службы](image/лаба7_6.png){#fig-006 width=70%}

## Создание пользовательской службы firewalld

Посмотрели список доступных FirewallD служб: ```firewall-cmd --get-services``` ([рис. @fig-007])

![Список доступных FirewallD служб](image/лаба7_7.png){#fig-007 width=70%}

## Создание пользовательской службы firewalld

Далее перезагрузили правила межсетевого экрана с сохранением информации о состоянии и вновь вывели на экран список служб, а также список активных служб ([рис. @fig-008]):

![Перезагрузка правил межсетевого экрана с сохранением информации о состоянии, список доступных служб, список активных служб](image/лаба7_8.png){#fig-008 width=60%}

## Создание пользовательской службы firewalld

Добавили новую службу в FirewallD и вывели на экран список активных служб ([рис. @fig-009]):

![Добавление новой службы в FirewallD, список активных служб](image/лаба7_9.png){#fig-009 width=70%}

## Создание пользовательской службы firewalld

Служба успешно добавлена в FirewallD, поэтому мы перезагрузили правила межсетевого экрана с сохранением информации о состоянии ([рис. @fig-010]):

![Перезагрузка правил межсетевого экрана с сохранением информации о состоянии](image/лаба7_10.png){#fig-010 width=70%}

## Перенаправление портов

Далее организовли на сервере переадресацию с порта 2022 на порт 22: ```firewall-cmd --add-forward-port=port=2022:proto=tcp:toport=22``` ([рис. @fig-011])

![Переадресация с порта 2022 на порт 22](image/лаба7_11.png){#fig-011 width=70%}

## Перенаправление портов

На клиенте попробовали получить доступ по SSH к серверу через порт 2022: ```ssh -p 2022 eavernikovskaya@server.eavernikovskaya.net``` ([рис. @fig-012]), ([рис. @fig-013])

![Запуск виртуальной машины client](image/лаба7_12.png){#fig-012 width=70%}

## Перенаправление портов

![Доступ на клиенте по SSH к серверу через порт 2022](image/лаба7_13.png){#fig-013 width=70%}

## Настройка Port Forwarding и Masquerading

На сервере посмотрели, активирована ли в ядре системы возможность перенаправления IPv4-пакетов: ```sysctl -a | grep forward``` ([рис. @fig-014])

![Проверка возможности перенаправления IPv4-пакетов в ядре системы](image/лаба7_14.png){#fig-014 width=35%}

## Настройка Port Forwarding и Masquerading

Далее включили перенаправление IPv4-пакетов на сервере ([рис. @fig-015]):

![Включение перенаправления IPv4-пакетов на сервере](image/лаба7_15.png){#fig-015 width=70%}

## Настройка Port Forwarding и Masquerading

Включили маскарадинг на сервере ([рис. @fig-016]):

![Включение маскарадинга на сервере](image/лаба7_16.png){#fig-016 width=70%}

## Настройка Port Forwarding и Masquerading

Далее на клиенте проверили доступность выхода в Интернет ([рис. @fig-017])

![Проверка входа в Интернет на клиенте](image/лаба7_17.png){#fig-017 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На виртуальной машине server перешли в каталог для внесения изменений в настройки внутреннего окружения */vagrant/provision/server/*, создали в нём каталог *firewall*, в который поместили в соответствующие подкаталоги конфигурационные файлы FirewallD ([рис. @fig-018]):

![Копирование конфигурационных файлов в каталог firewall](image/лаба7_18.png){#fig-018 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

В каталоге /vagrant/provision/server создали исполняемый файл firewall.sh ([рис. @fig-019]):

![Создание исполняемого файла firewall.sh](image/лаба7_19.png){#fig-019 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Открыв его на редактирование прописали в нём следующие строки ([рис. @fig-020]):

![Редактирование файла firewall.sh](image/лаба7_20.png){#fig-020 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Для отработки созданного скрипта во время загрузки виртуальных машин в конфигурационном файле Vagrantfile необходимо добавить в конфигурации сервера следующую запись ([рис. @fig-021]):

![Редактирование Vagrantfile](image/лаба7_21.png){#fig-021 width=60%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

После этого можно выключать виртуальные машины server и client: ```make server-halt``` и ```make client-halt```([рис. @fig-022])

![Выключение виртуальных машин server и client](image/лаба7_22.png){#fig-022 width=70%}

# Подведение итогов

## Выводы

В ходе выполнения лабораторной работы №7 мы получили навыки настройки межсетевого экрана в Linux в части переадресации портов и настройки Masquerading

## Список литературы

1. [Лаборатораня работа №7](https://esystem.rudn.ru/pluginfile.php/2854758/mod_resource/content/5/007-firewall.pdf)
